# Spring Security

## 关于Spring Security

Spring Security是主要解决认证（Authenticate）和授权（Authorization）的框架。

## 添加依赖

在Spring Boot项目中，添加`spring-boot-starter-security`依赖项。

注意：以上依赖项是带有自动配置的，一旦添加此依赖，整个项目中所有的访问，默认都是必须先登录才可以访问的，在浏览器输入任何此服务的URL，都会自动跳转到默认的登录页面。

默认的用户名是`user`，默认的密码是启动项目时自动生成的随机密码，在服务器端的控制台可以看到此密码。

当登录后，会自动跳转到此前尝试访问的页面。

Spring Security默认使用Session机制保存用户的登录状态，所以，重启服务后，登录状态会消失。在不重启的情况下，可以通过 `/logout` 访问“退出登录”页面，确定后也可以清除登录状态。

## 关于BCrypt

在Spring Security中，内置了BCrypt算法的工具类，此工具类可以实现使用BCrypt算法对密码进行加密、验证密码的功能。

BCrypt算法使用了随机盐，所以，多次使用相同的原文进行加密，得到的密文都将是不同的，并且，使用的盐值会作为密文的一部分，也就不会影响验证密码了。

在Spring Security框架中，定义了`PasswordEncoder`接口，表示“密码编码器”，并且使用`BCryptPasswordEncoder`实现了此接口。

## 在添加管理员时对密码进行加密

通常，应该自定义配置类，在配置类中使用`@Bean`方法，使得Spring框架能创建并管理`PasswordEncoder`类型的对象，在后续使用过程中，可以自动装配此对象。

在根包下创建`config.SecurityConfiguration`类：

```java
@Configuration
public class SecurityConfiguration {
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    
}
```

然后，在需要使用此对象的类中，自动装配即可，例如，在`AdminServiceImpl`类中添加：

```java
@Autowired
private PasswordEncoder passwordEncoder;
```

在此类中，就可以使用到以上属性，例如：

```java
String rawPassword = admin.getPassword();
String encodedPassword = passwordEncoder.encode(rawPassword);
admin.setPassword(encodedPassword);
```











