# 查询管理员列表

## 持久层

在根包下创建`pojo.vo.AdminListItemVO`类，在此类中添加属性：

```
id, username, nickname, avatar, phone, email, description, enable, last_login_ip, login_count, gmt_last_login
```

在`AdminMapper`接口中添加抽象方法：

```java
List<AdminListItemVO> list();
```

在`AdminMapper.xml`中配置SQL语句：

```xml
<select id="list" resultMap="ListResultMap">
    SELECT 
    	<include refid="ListQueryFields"/> 
    FROM 
    	ams_admin
    ORDER BY
    	id
</select>

<sql id="ListQueryFields">
    <if test="true">
        id, username, nickname, avatar, phone,
        email, description, enable, last_login_ip, login_count,
        gmt_last_login
    </if>
</sql>

<resultMap id="ListResultMap" type="cn.tedu.csmall.passport.pojo.vo.AdminListItemVO">
    <id column="id" property="id"/>
    <result column="username" property="username" />
    <result column="nickname" property="nickname" />
    <result column="avatar" property="avatar" />
    <result column="phone" property="phone" />
    <result column="email" property="email" />
    <result column="description" property="description" />
    <result column="enable" property="enable" />
    <result column="last_login_ip" property="lastLoginIp" />
    <result column="login_count" property="loginCount" />
    <result column="gmt_last_login" property="gmtLastLogin" />
</resultMap>
```

在`AdminMapperTests`中编写并执行测试：

```java
@Test
void testList() {
    List<?> list = mapper.list();
    log.debug("查询管理员列表，结果集中的数据的数量：{}", list.size());
    for (Object item : list) {
        log.debug("{}", item);
    }
}
```

## 业务逻辑层

在`IAdminService`接口中添加：

```java
List<AdminListItemVO> list();
```

在`AdminServiceImpl`中实现以上方法：

```java
public List<AdminListItemVO> list() {
    // 日志
    return adminMapper.list();
}
```

在`AdminServiceTests`中编写并执行测试：

```java
@Test
void testList() {
    List<?> list = service.list();
    log.debug("查询管理员列表，结果集中的数据的数量：{}", list.size());
    for (Object item : list) {
        log.debug("{}", item);
    }
}
```

## 控制器层

在`AdminController`中处理请求：

```java
@ApiOperation("查询管理员列表")
@ApiOperationSupport(order = 400)
@PreAuthorize("hasAuthority('/ams/admin/read')")
@GetMapping("")
public JsonResult<List<AdminListItemVO>> list() {
    log.debug("准备处理【查询管理员列表】的请求");
    List<AdminListItemVO> list = adminService.list();
    return JsonResult.ok(list);
}
```

# 删除管理员

## 持久层

当需要删除管理员时，需要执行的SQL语句大致是：

```mysql
delete from ams_admin where id=?
```

在执行删除之前，还应该检查此管理员的数据是否存在，可以通过“根据id查询管理员数据”来实现，需要执行的SQL语句大致是：

```mysql
select id, username, nickname …… from ams_admin where id=?
```

另外，由于各管理员都存在与角色的关联，当确定删除管理员数据时，此管理员与角色的关联数据也应该删除，需要执行的SQL语句大致是：

```mysql
delete from ams_admin_role where admin_id=?
```

则需要：

- 在根包下创建`pojo.vo.AdminStandardVO`类
- 在`AdminMapper`接口中添加抽象方法：`AdminStandardVO getStandardById(Long id);`
- 在`AdminMapper`接口中添加抽象方法：`int deleteById(Long id)`;
- 在`AdminRoleMapper`接口中添加抽象方法：`int deleteByAdminId(Long adminId);`





## 业务逻辑层

## 控制器层







